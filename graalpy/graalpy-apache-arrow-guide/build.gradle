plugins {
    id 'org.graalvm.python' version '25.0.0'
    id 'application'
    id 'java'
}

group = 'com.example'
version = '1.0-SNAPSHOT'
description = 'graalpy-apache-arrow-guide'

graalPy {
    community = true
    packages = [ // ①
                 'pandas', // ②
                 'pyarrow' // ③
    ]
}

repositories {
    maven {
        url = uri('file:///tmp/local_repo')
    }
    mavenCentral()
}

// Python version needs to be changed when we publish public artefacts
ext {
    arrowVersion = '17.0.0'
    pythonVersion = '25.0.0'
}

compileJava {
    options.compilerArgs << '--enable-preview'
}

tasks.withType(JavaExec) {
    jvmArgs = ['--enable-preview', '--add-opens=java.base/java.nio=org.apache.arrow.memory.core,ALL-UNNAMED']
}

dependencies {
    // Apache Arrow
    implementation "org.apache.arrow:arrow-vector:$arrowVersion" // ①
    implementation "org.apache.arrow:arrow-memory-unsafe:$arrowVersion" // ②

    // GraalPy
    implementation "org.graalvm.python:python-community:$pythonVersion" // ①
    implementation "org.graalvm.python:python-embedding:$pythonVersion" // ③
}

application {
    // Define the main class for the application.
    mainClass = 'com.example.Main'
}